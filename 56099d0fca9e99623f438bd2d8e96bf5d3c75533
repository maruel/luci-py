{
  "comments": [
    {
      "key": {
        "uuid": "63c58f63_c0ef7143",
        "filename": "appengine/components/components/auth/service_account.py",
        "patchSetId": 4
      },
      "lineNbr": 77,
      "author": {
        "id": 1002539
      },
      "writtenOn": "2018-10-17T18:55:13Z",
      "side": 1,
      "message": "this is no longer correct",
      "range": {
        "startLine": 77,
        "startChar": 48,
        "endLine": 77,
        "endChar": 63
      },
      "revId": "56099d0fca9e99623f438bd2d8e96bf5d3c75533",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7f0690ae_0bea47aa",
        "filename": "appengine/components/components/auth/service_account.py",
        "patchSetId": 4
      },
      "lineNbr": 77,
      "author": {
        "id": 1307247
      },
      "writtenOn": "2018-10-17T23:22:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "63c58f63_c0ef7143",
      "range": {
        "startLine": 77,
        "startChar": 48,
        "endLine": 77,
        "endChar": 63
      },
      "revId": "56099d0fca9e99623f438bd2d8e96bf5d3c75533",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cc364bfe_490c9e67",
        "filename": "appengine/components/components/auth/service_account.py",
        "patchSetId": 4
      },
      "lineNbr": 80,
      "author": {
        "id": 1002539
      },
      "writtenOn": "2018-10-17T18:55:13Z",
      "side": 1,
      "message": "nit: it is now called serviceAccountTokenCreator\n\nplease also mention that it requires enabling Credentials API",
      "range": {
        "startLine": 80,
        "startChar": 23,
        "endLine": 80,
        "endChar": 42
      },
      "revId": "56099d0fca9e99623f438bd2d8e96bf5d3c75533",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7cc2a965_a38c2d02",
        "filename": "appengine/components/components/auth/service_account.py",
        "patchSetId": 4
      },
      "lineNbr": 80,
      "author": {
        "id": 1307247
      },
      "writtenOn": "2018-10-17T23:22:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "cc364bfe_490c9e67",
      "range": {
        "startLine": 80,
        "startChar": 23,
        "endLine": 80,
        "endChar": 42
      },
      "revId": "56099d0fca9e99623f438bd2d8e96bf5d3c75533",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0cbd65f2_f752f6e4",
        "filename": "appengine/components/components/auth/service_account.py",
        "patchSetId": 4
      },
      "lineNbr": 139,
      "author": {
        "id": 1002539
      },
      "writtenOn": "2018-10-17T18:55:13Z",
      "side": 1,
      "message": "this is not correct, it still calls https://www.googleapis.com/oauth2/v4/token",
      "range": {
        "startLine": 139,
        "startChar": 4,
        "endLine": 139,
        "endChar": 26
      },
      "revId": "56099d0fca9e99623f438bd2d8e96bf5d3c75533",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "05b0a247_b37e8abf",
        "filename": "appengine/components/components/auth/service_account.py",
        "patchSetId": 4
      },
      "lineNbr": 139,
      "author": {
        "id": 1307247
      },
      "writtenOn": "2018-10-17T23:22:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0cbd65f2_f752f6e4",
      "range": {
        "startLine": 139,
        "startChar": 4,
        "endLine": 139,
        "endChar": 26
      },
      "revId": "56099d0fca9e99623f438bd2d8e96bf5d3c75533",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "49901a9f_e7914650",
        "filename": "appengine/components/components/auth/service_account.py",
        "patchSetId": 4
      },
      "lineNbr": 281,
      "author": {
        "id": 1002539
      },
      "writtenOn": "2018-10-17T18:55:13Z",
      "side": 1,
      "message": "would it be hard to reuse caching code?\n\ne.g. \n\n\n  @ndb.tasklet\n  def _get_cached_or_mint(cache_key, min_lifetime_sec, minter):\n    \u003ccheck cache, like in _get_jwt_based_token_async\u003e\n    on cache miss token_info \u003d yield minter()\n    \u003cupdate cache\u003e\n    raise ndb.Return((token_info[\u0027access_token\u0027], token_info[\u0027exp_ts\u0027]))\n\n  @ndb.tasklet\n  def _get_jwt_based_token_async(scopes, cache_key, min_lifetime_sec, signer):\n    tok, exp \u003d yield _get_cached_or_mint(\n        cache_key, \n        min_lifetime_sec,\n        lambda: _mint_jwt_based_token_async(scopes, signer))\n    raise ndb.Return((tok, exp))\n\nAnd then same for the new function.",
      "range": {
        "startLine": 272,
        "startChar": 0,
        "endLine": 281,
        "endChar": 0
      },
      "revId": "56099d0fca9e99623f438bd2d8e96bf5d3c75533",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a01a0c31_8f6d0e68",
        "filename": "appengine/components/components/auth/service_account.py",
        "patchSetId": 4
      },
      "lineNbr": 281,
      "author": {
        "id": 1307247
      },
      "writtenOn": "2018-10-17T23:22:13Z",
      "side": 1,
      "message": "I refactored the code such that caching is reused across functions.",
      "parentUuid": "49901a9f_e7914650",
      "range": {
        "startLine": 272,
        "startChar": 0,
        "endLine": 281,
        "endChar": 0
      },
      "revId": "56099d0fca9e99623f438bd2d8e96bf5d3c75533",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0a665b75_30fd4e6d",
        "filename": "appengine/components/components/auth/service_account.py",
        "patchSetId": 4
      },
      "lineNbr": 295,
      "author": {
        "id": 1002539
      },
      "writtenOn": "2018-10-17T18:55:13Z",
      "side": 1,
      "message": "this looks like abuse of duration_pb2 :( We aren\u0027t really using protos here. Considering we work with seconds precision only, please just do \n\n  \"%ds\" % min_lifetime_secs",
      "range": {
        "startLine": 293,
        "startChar": 6,
        "endLine": 295,
        "endChar": 58
      },
      "revId": "56099d0fca9e99623f438bd2d8e96bf5d3c75533",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8d6f8570_404b2381",
        "filename": "appengine/components/components/auth/service_account.py",
        "patchSetId": 4
      },
      "lineNbr": 295,
      "author": {
        "id": 1307247
      },
      "writtenOn": "2018-10-17T23:22:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0a665b75_30fd4e6d",
      "range": {
        "startLine": 293,
        "startChar": 6,
        "endLine": 295,
        "endChar": 58
      },
      "revId": "56099d0fca9e99623f438bd2d8e96bf5d3c75533",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9622507c_972b3de9",
        "filename": "appengine/components/components/auth/service_account.py",
        "patchSetId": 4
      },
      "lineNbr": 308,
      "author": {
        "id": 1002539
      },
      "writtenOn": "2018-10-17T18:55:13Z",
      "side": 1,
      "message": "does it really work?... Content-Type says application/json, yet we sent it URL-encoded scopes\u003d...\u0026lifetime\u003d...\n\nI think it should be\n\n  payload\u003dutils.encode_to_json(request_params)",
      "range": {
        "startLine": 308,
        "startChar": 16,
        "endLine": 308,
        "endChar": 28
      },
      "revId": "56099d0fca9e99623f438bd2d8e96bf5d3c75533",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9f044b9c_2afb270e",
        "filename": "appengine/components/components/auth/service_account.py",
        "patchSetId": 4
      },
      "lineNbr": 308,
      "author": {
        "id": 1307247
      },
      "writtenOn": "2018-10-17T23:22:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9622507c_972b3de9",
      "range": {
        "startLine": 308,
        "startChar": 16,
        "endLine": 308,
        "endChar": 28
      },
      "revId": "56099d0fca9e99623f438bd2d8e96bf5d3c75533",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "51860a8e_a8433c5f",
        "filename": "appengine/components/components/auth/service_account.py",
        "patchSetId": 4
      },
      "lineNbr": 310,
      "author": {
        "id": 1002539
      },
      "writtenOn": "2018-10-17T18:55:13Z",
      "side": 1,
      "message": "Use utils.parse_rfc3339_datetime: https://chromium.googlesource.com/infra/luci/luci-py/+/master/appengine/components/components/utils.py#142 (it uses exact same algo as used by protobuf).",
      "range": {
        "startLine": 310,
        "startChar": 16,
        "endLine": 310,
        "endChar": 45
      },
      "revId": "56099d0fca9e99623f438bd2d8e96bf5d3c75533",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "15232f2e_0f9cb4a7",
        "filename": "appengine/components/components/auth/service_account.py",
        "patchSetId": 4
      },
      "lineNbr": 310,
      "author": {
        "id": 1307247
      },
      "writtenOn": "2018-10-17T23:22:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "51860a8e_a8433c5f",
      "range": {
        "startLine": 310,
        "startChar": 16,
        "endLine": 310,
        "endChar": 45
      },
      "revId": "56099d0fca9e99623f438bd2d8e96bf5d3c75533",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}