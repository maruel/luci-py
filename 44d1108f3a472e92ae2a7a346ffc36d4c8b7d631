{
  "comments": [
    {
      "key": {
        "uuid": "260d087a_edd2a127",
        "filename": "appengine/swarming/handlers_endpoints.py",
        "patchSetId": 2
      },
      "lineNbr": 530,
      "author": {
        "id": 1000487
      },
      "writtenOn": "2018-08-01T20:57:03Z",
      "side": 1,
      "message": "Oh, my idea was more:\n\nClient knows the exact tasks is cares about. So the client sends all the task ids as a flat list, and the short result is returned.\n\nThis is better than using a query, because query are eventually consistent, which could cause issues on the long tail (e.g. once per day) which would be annoying.\n\nAnother advantage is that you don\u0027t need to support pagination, the client would be allowed to pass at most X tasks (let\u0027s say 20) and that\u0027s it. If the client wants to see more, they just send parallel queries, but that\u0027s still a 20x reduction of RPCs, which isn\u0027t too shabby.",
      "range": {
        "startLine": 530,
        "startChar": 6,
        "endLine": 530,
        "endChar": 18
      },
      "revId": "44d1108f3a472e92ae2a7a346ffc36d4c8b7d631",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1a009dd2_79e648c1",
        "filename": "appengine/swarming/handlers_endpoints.py",
        "patchSetId": 2
      },
      "lineNbr": 530,
      "author": {
        "id": 1148599
      },
      "writtenOn": "2018-08-01T20:58:13Z",
      "side": 1,
      "message": "Ah ok. \n\nWhat exactly would the result be? Just a list of states?\n\nAnd would I just do a bunch of parallel gets, instead of a query?",
      "parentUuid": "260d087a_edd2a127",
      "range": {
        "startLine": 530,
        "startChar": 6,
        "endLine": 530,
        "endChar": 18
      },
      "revId": "44d1108f3a472e92ae2a7a346ffc36d4c8b7d631",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9fb6ed94_41154a02",
        "filename": "appengine/swarming/handlers_endpoints.py",
        "patchSetId": 2
      },
      "lineNbr": 530,
      "author": {
        "id": 1000487
      },
      "writtenOn": "2018-08-01T21:03:06Z",
      "side": 1,
      "message": "For the gets: more or less yes, it\u0027s a ndb.get_multi().\n\nFor the result, I see two ways:\n- Flat list of state, as you mention.\n- Returning the full data but *only* when the task is not PENDING/RUNNING, otherwise it would only return the state (one of PENDING or RUNNIG).\n\nThe second option would save the client the need to send a second HTTP request to get the actual results. That would make the \"fast path\" where the client calls when the tasks had completed really fast. I don\u0027t have strong opinion though, as this makes the client logic a bit more complex. I don\u0027t know if in practice it\u0027d save enough HTTPs request overhead to be worth it.",
      "parentUuid": "1a009dd2_79e648c1",
      "range": {
        "startLine": 530,
        "startChar": 6,
        "endLine": 530,
        "endChar": 18
      },
      "revId": "44d1108f3a472e92ae2a7a346ffc36d4c8b7d631",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f6c05351_46efc2cc",
        "filename": "appengine/swarming/swarming_rpcs.py",
        "patchSetId": 2
      },
      "lineNbr": 656,
      "author": {
        "id": 1000487
      },
      "writtenOn": "2018-08-01T20:57:03Z",
      "side": 1,
      "message": "Remove.",
      "revId": "44d1108f3a472e92ae2a7a346ffc36d4c8b7d631",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}