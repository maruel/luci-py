{
  "comments": [
    {
      "key": {
        "uuid": "e3e422e8_d92d6392",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2020-09-03T04:40:31Z",
      "side": 1,
      "message": "Some tests are still failing. But I want to confirm if the direction of handling invalid dimension value type is good.",
      "revId": "1ba23d4a40bd1b29589d40c63222a301399b1ff6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e0c2dd19_11f0afda",
        "filename": "appengine/swarming/server/config.py",
        "patchSetId": 7
      },
      "lineNbr": 93,
      "author": {
        "id": 1161379
      },
      "writtenOn": "2020-09-03T04:45:35Z",
      "side": 1,
      "message": "redundant paren?",
      "range": {
        "startLine": 93,
        "startChar": 9,
        "endLine": 93,
        "endChar": 10
      },
      "revId": "1ba23d4a40bd1b29589d40c63222a301399b1ff6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8f26edf5_a806f90c",
        "filename": "appengine/swarming/server/task_queues.py",
        "patchSetId": 7
      },
      "lineNbr": 913,
      "author": {
        "id": 1161379
      },
      "writtenOn": "2020-09-03T04:45:35Z",
      "side": 1,
      "message": "I think doing validation here is not right place.\nIs this necessary?",
      "revId": "1ba23d4a40bd1b29589d40c63222a301399b1ff6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6d402178_ec36d5dd",
        "filename": "appengine/swarming/server/task_queues.py",
        "patchSetId": 7
      },
      "lineNbr": 913,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2020-09-03T04:50:21Z",
      "side": 1,
      "message": "The \"values[vi].split\" below fails if it\u0027s not string.  \nThe question I have here is\n- Do we want to deal with only valid dimensions?\n- Or, should we tolerate invalid dimensions? like trimming too long dimension.\n\nNote that dimension validation is already done at _process() in handlers_bot.py. But we need to store BotInfo and BotEvent.",
      "parentUuid": "8f26edf5_a806f90c",
      "revId": "1ba23d4a40bd1b29589d40c63222a301399b1ff6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "85581051_2712511a",
        "filename": "appengine/swarming/server/task_queues.py",
        "patchSetId": 7
      },
      "lineNbr": 913,
      "author": {
        "id": 1161379
      },
      "writtenOn": "2020-09-03T05:41:19Z",
      "side": 1,
      "message": "\u003e The \"values[vi].split\" below fails if it\u0027s not string.  \n\u003e The question I have here is\n\u003e - Do we want to deal with only valid dimensions?\n\nI think we only want to deal dimension which doesn\u0027t cause exception without extra validation check.\n\n\u003e - Or, should we tolerate invalid dimensions? like trimming too long dimension.\n\u003e \n\u003e Note that dimension validation is already done at _process() in handlers_bot.py. But we need to store BotInfo and BotEvent.\n\nCan we return 400 in that case?",
      "parentUuid": "6d402178_ec36d5dd",
      "revId": "1ba23d4a40bd1b29589d40c63222a301399b1ff6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d8d1efaa_841477c5",
        "filename": "appengine/swarming/server/task_queues.py",
        "patchSetId": 7
      },
      "lineNbr": 913,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2020-09-03T05:46:27Z",
      "side": 1,
      "message": "\u003e I think we only want to deal dimension which doesn\u0027t cause exception without extra validation check.\n\nThe thing is this function is expected to tolerate invalid dimensions at this moment, and already handle too long dimension around L920-925.\nI want this function to behave consistently.\n\n\u003e Can we return 400 in that case?\nI wrote the reason in the description.",
      "parentUuid": "85581051_2712511a",
      "revId": "1ba23d4a40bd1b29589d40c63222a301399b1ff6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e70e7286_30f36c2e",
        "filename": "appengine/swarming/server/task_queues.py",
        "patchSetId": 7
      },
      "lineNbr": 913,
      "author": {
        "id": 1161379
      },
      "writtenOn": "2020-09-03T06:17:28Z",
      "side": 1,
      "message": "\u003e \u003e I think we only want to deal dimension which doesn\u0027t cause exception without extra validation check.\n\u003e \n\u003e The thing is this function is expected to tolerate invalid dimensions at this moment, and already handle too long dimension around L920-925.\n\u003e I want this function to behave consistently.\n\u003e \n\nI think this check is not sufficient if we want to have consistency (if dimensions is None, this function throw exception in the first line). Also I feel exception is more safe than getting dimension set not having some values silently.\n\n\u003e \u003e Can we return 400 in that case?\n\u003e I wrote the reason in the description.\n\nI think it is better not to try harder to handle invalid data as long as we leave logs in server. Considering current capacity of us, I\u0027d like to assume that our customer basically have responsibility to send valid request to server.",
      "parentUuid": "d8d1efaa_841477c5",
      "revId": "1ba23d4a40bd1b29589d40c63222a301399b1ff6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "52cd58b7_4c19b9d5",
        "filename": "appengine/swarming/server/task_queues.py",
        "patchSetId": 7
      },
      "lineNbr": 913,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2020-09-03T06:25:11Z",
      "side": 1,
      "message": "FWIU, \"quarantine\" mode is used for the bots in invalid state.\nAnd bot owners can easily see why the bots are unhealthy in the UI with saving BotInfo/BotEvent.\n\nFrom my experience, people outside of Swarming team don\u0027t usually see server logs and file bugs. (Some experts do, but only some...)\nSo I concern it will make us more busy for responding.",
      "parentUuid": "e70e7286_30f36c2e",
      "revId": "1ba23d4a40bd1b29589d40c63222a301399b1ff6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "36709ed0_6937f611",
        "filename": "appengine/swarming/server/task_queues.py",
        "patchSetId": 7
      },
      "lineNbr": 913,
      "author": {
        "id": 1161379
      },
      "writtenOn": "2020-09-03T06:49:21Z",
      "side": 1,
      "message": "I think showing message like \"Key foo has invalid value: ...\" doesn\u0027t help a lot for such people.",
      "parentUuid": "52cd58b7_4c19b9d5",
      "revId": "1ba23d4a40bd1b29589d40c63222a301399b1ff6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d604d3ee_789e4e70",
        "filename": "appengine/swarming/server/task_queues.py",
        "patchSetId": 7
      },
      "lineNbr": 913,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2020-09-03T06:59:42Z",
      "side": 1,
      "message": "If it\u0027s a message issue, how about\n\n\"Dimensions \"foo\" has invalid value: ...\"?\n\nWill revise other quarantine messages, too.",
      "parentUuid": "36709ed0_6937f611",
      "revId": "1ba23d4a40bd1b29589d40c63222a301399b1ff6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "26bf0722_ea6e5c27",
        "filename": "appengine/swarming/server/task_queues.py",
        "patchSetId": 7
      },
      "lineNbr": 916,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2020-09-03T04:46:06Z",
      "side": 1,
      "message": "Do we want to convert the invalid dimensions to string?\nThe description of the function saids \"This function can be called with invalid dimensions that are reported by the bot. Tolerate them, ...\".",
      "range": {
        "startLine": 913,
        "startChar": 0,
        "endLine": 916,
        "endChar": 12
      },
      "revId": "1ba23d4a40bd1b29589d40c63222a301399b1ff6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}