{
  "comments": [
    {
      "key": {
        "uuid": "e4563f87_9fd6cdd9",
        "filename": "appengine/swarming/server/bot_management.py",
        "patchSetId": 5
      },
      "lineNbr": 366,
      "author": {
        "id": 1000487
      },
      "writtenOn": "2019-11-15T15:53:50Z",
      "side": 1,
      "message": "I recommend adding this first as a separate CL. The problem is line 383 below. This means that old code won\u0027t be able to load a BotEvent entity with the new value.\n\nI wanted to have it check at storage, not a reading, but ndb does both. An alternative would be to move the choices from line 383 into a new _pre_put_hook() function that would check at storage, but will be fine when reading.\n\nStill, the risk is that it is still a race condition: a new version generates the bot_missing, while concurrently an old version reaps it and tries to send it to BQ. This would lead to an exception.\n\nSo the check at reading as \"some\" value, albeit it makes this kind of release more annoying.\n\nWhen doing this kind of change, I recommend to use the occasion to delete old versions too, since they will blow up if ever used.",
      "revId": "85554ef2ebe3bef423de97668a0dce7068158b03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a2ceac20_c8ec336a",
        "filename": "appengine/swarming/server/bot_management.py",
        "patchSetId": 5
      },
      "lineNbr": 366,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2019-11-15T22:08:23Z",
      "side": 1,
      "message": "Thank you for your comment.\n\nI created a CL adding the event type.\nhttps://crrev.com/c/1916993\n\nWill deploy it and remove old versions before landing this CL.\n\n\u003e move the choices from line 383 into a new _pre_put_hook()\n\nWill also consider this next week.",
      "parentUuid": "e4563f87_9fd6cdd9",
      "revId": "85554ef2ebe3bef423de97668a0dce7068158b03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9a4b68c0_df8c0466",
        "filename": "appengine/swarming/server/bot_management.py",
        "patchSetId": 5
      },
      "lineNbr": 565,
      "author": {
        "id": 1161379
      },
      "writtenOn": "2019-11-15T10:25:33Z",
      "side": 1,
      "message": "bot status ?",
      "range": {
        "startLine": 565,
        "startChar": 58,
        "endLine": 565,
        "endChar": 61
      },
      "revId": "85554ef2ebe3bef423de97668a0dce7068158b03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "22d86ad5_fa1be5c6",
        "filename": "appengine/swarming/server/bot_management.py",
        "patchSetId": 5
      },
      "lineNbr": 565,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2019-11-15T22:08:23Z",
      "side": 1,
      "message": "It\u0027s composite, actually. I was trying not to use \u0027bot status\u0027 since it can be confused with \u0027bot state\u0027.",
      "parentUuid": "9a4b68c0_df8c0466",
      "range": {
        "startLine": 565,
        "startChar": 58,
        "endLine": 565,
        "endChar": 61
      },
      "revId": "85554ef2ebe3bef423de97668a0dce7068158b03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b47a173c_2398bb66",
        "filename": "appengine/swarming/server/bot_management.py",
        "patchSetId": 5
      },
      "lineNbr": 595,
      "author": {
        "id": 1161379
      },
      "writtenOn": "2019-11-15T10:25:33Z",
      "side": 1,
      "message": "\u0027We assume it ...\u0027?",
      "range": {
        "startLine": 595,
        "startChar": 7,
        "endLine": 595,
        "endChar": 10
      },
      "revId": "85554ef2ebe3bef423de97668a0dce7068158b03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7a7e5fbd_88c57fb6",
        "filename": "appengine/swarming/server/bot_management.py",
        "patchSetId": 5
      },
      "lineNbr": 595,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2019-11-15T22:08:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b47a173c_2398bb66",
      "range": {
        "startLine": 595,
        "startChar": 7,
        "endLine": 595,
        "endChar": 10
      },
      "revId": "85554ef2ebe3bef423de97668a0dce7068158b03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "400a2460_0083aa88",
        "filename": "appengine/swarming/server/bot_management.py",
        "patchSetId": 5
      },
      "lineNbr": 713,
      "author": {
        "id": 1161379
      },
      "writtenOn": "2019-11-15T10:25:33Z",
      "side": 1,
      "message": "why not return True/False ?",
      "range": {
        "startLine": 712,
        "startChar": 0,
        "endLine": 713,
        "endChar": 34
      },
      "revId": "85554ef2ebe3bef423de97668a0dce7068158b03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bb2e9638_5510f9e4",
        "filename": "appengine/swarming/server/bot_management.py",
        "patchSetId": 5
      },
      "lineNbr": 713,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2019-11-15T22:08:23Z",
      "side": 1,
      "message": "bot_key will be used to send bot_event. I\u0027m not sure why it was 0/1.",
      "parentUuid": "400a2460_0083aa88",
      "range": {
        "startLine": 712,
        "startChar": 0,
        "endLine": 713,
        "endChar": 34
      },
      "revId": "85554ef2ebe3bef423de97668a0dce7068158b03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8e9889ca_f7be298c",
        "filename": "appengine/swarming/server/bot_management.py",
        "patchSetId": 5
      },
      "lineNbr": 713,
      "author": {
        "id": 1161379
      },
      "writtenOn": "2019-11-19T00:11:24Z",
      "side": 1,
      "message": "I menat to say about 0/1, first element of returned tuple.\nBut better to return None in 0 case and return bot_key in 1 case?",
      "parentUuid": "bb2e9638_5510f9e4",
      "range": {
        "startLine": 712,
        "startChar": 0,
        "endLine": 713,
        "endChar": 34
      },
      "revId": "85554ef2ebe3bef423de97668a0dce7068158b03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2677f868_3c15ecaf",
        "filename": "appengine/swarming/server/bot_management.py",
        "patchSetId": 5
      },
      "lineNbr": 713,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2019-11-19T02:17:34Z",
      "side": 1,
      "message": "Hm, I don\u0027t prefer to use None to *imply* something (not success in this code). \nI\u0027m ok in this specific case, though.",
      "parentUuid": "8e9889ca_f7be298c",
      "range": {
        "startLine": 712,
        "startChar": 0,
        "endLine": 713,
        "endChar": 34
      },
      "revId": "85554ef2ebe3bef423de97668a0dce7068158b03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}